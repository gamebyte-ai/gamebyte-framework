<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameByte - Graphics API Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: 'Segoe UI', sans-serif;
        }
        #game-container {
            position: relative;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            border-radius: 10px;
            overflow: hidden;
        }
        #info {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #fff;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            max-width: 250px;
            backdrop-filter: blur(10px);
        }
        .info-title {
            font-weight: bold;
            color: #4ecca3;
            margin-bottom: 8px;
        }
        .info-item {
            margin: 4px 0;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="info">
            <div class="info-title">üé® Graphics API Test</div>
            <div class="info-item">‚úÖ Using graphics() factory</div>
            <div class="info-item">‚úÖ Renderer-independent code</div>
            <div class="info-item">üí° Check console for logs!</div>
        </div>
    </div>

    <!-- Load Pixi.js from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8.14.0/dist/pixi.min.js"></script>

    <!-- Load GameByte UMD Build -->
    <script src="./dist/gamebyte.umd.js"></script>

    <script>
        const { createGame, BaseScene, graphics } = GameByteFramework;

        let game, sceneManager, renderer;

        // Graphics API Test Scene
        class GraphicsAPIScene extends BaseScene {
            constructor() {
                super('graphics-api-test', 'Graphics API Test');
            }

            async initialize() {
                await super.initialize();
                console.log('‚úÖ Graphics API Scene initializing...');

                // Test if graphics() function is available
                console.log('üîç Testing graphics() function:', typeof graphics);

                if (typeof graphics === 'function') {
                    console.log('‚úÖ graphics() function available!');

                    // Create a container using graphics() API
                    const testContainer = graphics().createContainer();
                    console.log('‚úÖ Created container via graphics():', testContainer);

                    // Create graphics using graphics() API
                    const testGraphics = graphics().createGraphics();
                    console.log('‚úÖ Created graphics via graphics():', testGraphics);

                    // Draw a rectangle
                    testGraphics.rect(100, 100, 200, 150);
                    testGraphics.fill({ color: 0x4ECCA3 });

                    testContainer.addChild(testGraphics);
                    this.container.addChild(testContainer);

                    // Create text using graphics() API
                    const testText = graphics().createText('Graphics API Works!', {
                        fontFamily: 'Arial',
                        fontSize: 32,
                        fill: 0xFFFFFF
                    });
                    if (testText.anchor) {
                        testText.anchor.set(0.5, 0.5);
                    }
                    testText.x = 400;
                    testText.y = 300;
                    this.container.addChild(testText);

                    console.log('üéâ All graphics() API tests passed!');
                } else {
                    console.error('‚ùå graphics() function not available!');
                    console.log('Available in GameByteFramework:', Object.keys(GameByteFramework));
                }

                // Add background
                const bg = graphics().createGraphics();
                bg.rect(0, 0, 800, 600);
                bg.fill({ color: 0x1a1a2e });
                this.container.addChildAt(bg, 0);

                console.log('‚úÖ Graphics API Scene initialized');
            }
        }

        async function init() {
            try {
                console.log('üéÆ Initializing Graphics API Test...');
                console.log('üîç GameByteFramework exports:', Object.keys(GameByteFramework));

                // 1. Create game
                game = createGame();
                console.log('‚úÖ GameByte created');

                // 2. Create canvas
                const canvas = document.createElement('canvas');
                canvas.width = 800;
                canvas.height = 600;
                document.getElementById('game-container').insertBefore(canvas, document.getElementById('info'));
                console.log('‚úÖ Canvas created: 800x600');

                // 3. Initialize
                await game.initialize(canvas, '2d');
                console.log('‚úÖ Game initialized');

                // 4. Get managers
                sceneManager = game.make('scene.manager');
                renderer = game.make('renderer');
                console.log('‚úÖ Managers obtained');

                // 5. Create and add scene
                const testScene = new GraphicsAPIScene();
                sceneManager.add(testScene);
                console.log('‚úÖ Scene added');

                // 6. Switch to scene
                await sceneManager.switchTo('graphics-api-test');
                console.log('‚úÖ Scene activated');

                // 7. Add scene container to stage
                const stage = renderer.getStage();
                const currentScene = sceneManager.getCurrentScene();
                if (stage && currentScene) {
                    stage.addChild(currentScene.getContainer());
                    console.log('‚úÖ Scene container added to stage');
                }

                // 8. Hook renderer
                renderer.on('tick', (deltaTime) => {
                    sceneManager.update(deltaTime);
                });

                // 9. Start game loop
                game.start();
                console.log('‚úÖ Game loop started');

                console.log('üéâ Graphics API Test running!');

            } catch (error) {
                console.error('‚ùå Error:', error);
            }
        }

        // Wait for everything to load
        window.addEventListener('load', init);
    </script>
</body>
</html>
