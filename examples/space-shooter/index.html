<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Shooter - GameByte Framework</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            overflow: hidden;
            background: #0a0a1a;
            touch-action: none;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Load dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
    <script src="../../dist/gamebyte.umd.js"></script>

    <script>
        // GameByte Space Shooter Example
        // Demonstrates: Splash -> Loading -> Menu -> Game -> GameOver flow

        const { createGame } = GameByteFramework;

        // Game configuration
        const CONFIG = {
            width: 480,
            height: 720,
            playerSpeed: 6,
            bulletSpeed: 12,
            enemySpeed: 2,
            fireRate: 150,
            spawnRate: 1000
        };

        // Game state
        const gameState = {
            score: 0,
            lives: 3,
            wave: 1,
            bullets: [],
            enemies: [],
            powerUps: [],
            gameOver: false,
            lastFireTime: 0,
            lastSpawnTime: 0
        };

        // Create game instance
        const game = createGame();

        // Create canvas
        const canvas = document.createElement('canvas');
        canvas.width = CONFIG.width;
        canvas.height = CONFIG.height;
        document.body.appendChild(canvas);

        // Main initialization
        (async () => {
            await game.initialize(canvas, '2d');

            const renderer = game.make('renderer');
            const inputManager = game.make('input');
            const stage = renderer.getStage();

            // Scene containers
            const scenes = {
                splash: new PIXI.Container(),
                loading: new PIXI.Container(),
                menu: new PIXI.Container(),
                game: new PIXI.Container(),
                gameOver: new PIXI.Container()
            };

            let currentScene = null;
            let playerSprite = null;
            let topBar = null;
            let gameContainer = null;
            let starsContainer = null;

            // Input state
            const keys = { left: false, right: false, up: false, down: false, fire: false };

            // ============================================
            // SCENE: SPLASH
            // ============================================
            function createSplashScene() {
                const container = scenes.splash;
                container.removeChildren();

                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(0x0a0a1a);
                container.addChild(bg);

                // Starfield background
                for (let i = 0; i < 50; i++) {
                    const star = new PIXI.Graphics();
                    star.circle(0, 0, Math.random() * 2 + 0.5);
                    star.fill(0xffffff);
                    star.x = Math.random() * CONFIG.width;
                    star.y = Math.random() * CONFIG.height;
                    star.alpha = Math.random() * 0.5 + 0.5;
                    container.addChild(star);
                }

                // Logo
                const logoContainer = new PIXI.Container();
                logoContainer.x = CONFIG.width / 2;
                logoContainer.y = CONFIG.height / 2 - 30;

                const logo = new PIXI.Graphics();
                logo.rect(-50, -20, 25, 35);
                logo.fill(0xffffff);
                logo.rect(-15, -35, 25, 35);
                logo.fill(0xffffff);
                logo.rect(-15, 10, 25, 35);
                logo.fill(0xffffff);
                logo.rect(20, -20, 65, 40);
                logo.fill(0xffffff);

                logoContainer.addChild(logo);
                container.addChild(logoContainer);

                const brandText = new PIXI.Text({
                    text: 'GameByte',
                    style: {
                        fontFamily: 'Arial Black, Arial',
                        fontSize: 32,
                        fill: 0xffffff,
                        fontWeight: 'bold'
                    }
                });
                brandText.anchor.set(0.5);
                brandText.x = CONFIG.width / 2;
                brandText.y = CONFIG.height / 2 + 50;
                container.addChild(brandText);

                setTimeout(() => switchScene('loading'), 2000);
            }

            // ============================================
            // SCENE: LOADING
            // ============================================
            function createLoadingScene() {
                const container = scenes.loading;
                container.removeChildren();

                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(0x0a0a1a);
                container.addChild(bg);

                const loadingText = new PIXI.Text({
                    text: 'Loading',
                    style: { fontFamily: 'Arial', fontSize: 24, fill: 0xffffff }
                });
                loadingText.anchor.set(0.5);
                loadingText.x = CONFIG.width / 2;
                loadingText.y = CONFIG.height - 60;
                container.addChild(loadingText);

                setTimeout(() => switchScene('menu'), 1500);
            }

            // ============================================
            // SCENE: MENU
            // ============================================
            function createMenuScene() {
                const container = scenes.menu;
                container.removeChildren();

                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(0x0a0a1a);
                container.addChild(bg);

                // Stars
                for (let i = 0; i < 100; i++) {
                    const star = new PIXI.Graphics();
                    star.circle(0, 0, Math.random() * 2 + 0.5);
                    star.fill(0xffffff);
                    star.x = Math.random() * CONFIG.width;
                    star.y = Math.random() * CONFIG.height;
                    star.alpha = Math.random() * 0.5 + 0.5;
                    container.addChild(star);
                }

                // Title
                const title = new PIXI.Text({
                    text: 'SPACE\nSHOOTER',
                    style: {
                        fontFamily: 'Arial Black, Arial',
                        fontSize: 56,
                        fill: 0x00ffff,
                        fontWeight: 'bold',
                        align: 'center',
                        lineHeight: 60
                    }
                });
                title.anchor.set(0.5);
                title.x = CONFIG.width / 2;
                title.y = 180;
                container.addChild(title);

                // Ship preview
                const ship = new PIXI.Graphics();
                ship.moveTo(0, -25);
                ship.lineTo(20, 25);
                ship.lineTo(0, 15);
                ship.lineTo(-20, 25);
                ship.closePath();
                ship.fill(0x00ffff);
                ship.x = CONFIG.width / 2;
                ship.y = 340;
                container.addChild(ship);

                // Play button
                const playButton = createButton('PLAY', CONFIG.width / 2, 450, 0x00aa00, () => {
                    resetGame();
                    switchScene('game');
                });
                container.addChild(playButton);

                // Controls
                const controls = new PIXI.Text({
                    text: 'Arrow Keys to move\nSpace to shoot',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 14,
                        fill: 0x666666,
                        align: 'center'
                    }
                });
                controls.anchor.set(0.5);
                controls.x = CONFIG.width / 2;
                controls.y = CONFIG.height - 60;
                container.addChild(controls);

                // High score
                const highScore = localStorage.getItem('spaceShooterHighScore') || 0;
                const highScoreText = new PIXI.Text({
                    text: `High Score: ${highScore}`,
                    style: { fontFamily: 'Arial', fontSize: 18, fill: 0xFFD700 }
                });
                highScoreText.anchor.set(0.5);
                highScoreText.x = CONFIG.width / 2;
                highScoreText.y = 530;
                container.addChild(highScoreText);
            }

            // ============================================
            // SCENE: GAME
            // ============================================
            function createGameScene() {
                const container = scenes.game;
                container.removeChildren();

                // Background
                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(0x0a0a1a);
                container.addChild(bg);

                // Stars container
                starsContainer = new PIXI.Container();
                for (let i = 0; i < 100; i++) {
                    const star = new PIXI.Graphics();
                    star.circle(0, 0, Math.random() * 2 + 0.5);
                    star.fill(0xffffff);
                    star.x = Math.random() * CONFIG.width;
                    star.y = Math.random() * CONFIG.height;
                    star.alpha = Math.random() * 0.5 + 0.3;
                    star.speed = Math.random() * 2 + 1;
                    starsContainer.addChild(star);
                }
                container.addChild(starsContainer);

                // Game container
                gameContainer = new PIXI.Container();
                container.addChild(gameContainer);

                // Create player
                createPlayer();

                // TopBar
                topBar = createTopBar();
                container.addChild(topBar);

                // Lives display
                updateLivesDisplay();
            }

            function createPlayer() {
                playerSprite = new PIXI.Graphics();
                // Ship body
                playerSprite.moveTo(0, -20);
                playerSprite.lineTo(18, 20);
                playerSprite.lineTo(0, 12);
                playerSprite.lineTo(-18, 20);
                playerSprite.closePath();
                playerSprite.fill(0x00ffff);

                // Engine glow
                playerSprite.moveTo(-8, 20);
                playerSprite.lineTo(0, 30);
                playerSprite.lineTo(8, 20);
                playerSprite.fill(0xff6600);

                playerSprite.x = CONFIG.width / 2;
                playerSprite.y = CONFIG.height - 80;

                gameContainer.addChild(playerSprite);
            }

            function createTopBar() {
                const bar = new PIXI.Container();

                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, 50);
                bg.fill({ color: 0x000000, alpha: 0.7 });
                bar.addChild(bg);

                // Score
                const scoreText = new PIXI.Text({
                    text: 'Score: 0',
                    style: { fontFamily: 'Arial', fontSize: 20, fill: 0xffffff, fontWeight: 'bold' }
                });
                scoreText.x = 15;
                scoreText.y = 12;
                scoreText.name = 'scoreText';
                bar.addChild(scoreText);

                // Wave
                const waveText = new PIXI.Text({
                    text: 'Wave: 1',
                    style: { fontFamily: 'Arial', fontSize: 20, fill: 0x00ffff, fontWeight: 'bold' }
                });
                waveText.anchor.set(1, 0);
                waveText.x = CONFIG.width - 15;
                waveText.y = 12;
                waveText.name = 'waveText';
                bar.addChild(waveText);

                // Lives container
                const livesContainer = new PIXI.Container();
                livesContainer.x = CONFIG.width / 2 - 30;
                livesContainer.y = 25;
                livesContainer.name = 'livesContainer';
                bar.addChild(livesContainer);

                return bar;
            }

            function updateLivesDisplay() {
                if (!topBar) return;
                const livesContainer = topBar.getChildByName('livesContainer');
                if (!livesContainer) return;

                livesContainer.removeChildren();
                for (let i = 0; i < gameState.lives; i++) {
                    const life = new PIXI.Graphics();
                    life.moveTo(0, -8);
                    life.lineTo(8, 8);
                    life.lineTo(0, 4);
                    life.lineTo(-8, 8);
                    life.closePath();
                    life.fill(0x00ffff);
                    life.x = i * 25;
                    livesContainer.addChild(life);
                }
            }

            function updateTopBar() {
                if (!topBar) return;
                const scoreText = topBar.getChildByName('scoreText');
                const waveText = topBar.getChildByName('waveText');
                if (scoreText) scoreText.text = `Score: ${gameState.score}`;
                if (waveText) waveText.text = `Wave: ${gameState.wave}`;
            }

            // ============================================
            // GAME OBJECTS
            // ============================================
            function createBullet(x, y) {
                const bullet = new PIXI.Graphics();
                bullet.rect(-2, -8, 4, 16);
                bullet.fill(0xffff00);
                bullet.x = x;
                bullet.y = y;
                gameContainer.addChild(bullet);
                gameState.bullets.push(bullet);
            }

            function createEnemy(x, type = 'basic') {
                const enemy = new PIXI.Container();
                enemy.x = x;
                enemy.y = -30;
                enemy.type = type;
                enemy.health = type === 'tank' ? 3 : 1;

                const graphics = new PIXI.Graphics();
                if (type === 'basic') {
                    graphics.moveTo(0, 20);
                    graphics.lineTo(15, -15);
                    graphics.lineTo(0, -5);
                    graphics.lineTo(-15, -15);
                    graphics.closePath();
                    graphics.fill(0xff3333);
                } else if (type === 'tank') {
                    graphics.roundRect(-20, -15, 40, 30, 5);
                    graphics.fill(0xff6600);
                    graphics.circle(0, 0, 8);
                    graphics.fill(0xffcc00);
                } else if (type === 'fast') {
                    graphics.moveTo(0, 15);
                    graphics.lineTo(10, -10);
                    graphics.lineTo(-10, -10);
                    graphics.closePath();
                    graphics.fill(0xff00ff);
                }

                enemy.addChild(graphics);
                enemy.graphics = graphics;

                gameContainer.addChild(enemy);
                gameState.enemies.push(enemy);
            }

            function spawnWave() {
                const now = Date.now();
                if (now - gameState.lastSpawnTime < CONFIG.spawnRate) return;
                gameState.lastSpawnTime = now;

                const types = ['basic', 'basic', 'basic', 'fast', 'tank'];
                const type = types[Math.floor(Math.random() * Math.min(types.length, gameState.wave + 2))];
                const x = Math.random() * (CONFIG.width - 60) + 30;

                createEnemy(x, type);
            }

            // ============================================
            // SCENE: GAME OVER
            // ============================================
            function createGameOverScene() {
                const container = scenes.gameOver;
                container.removeChildren();

                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill({ color: 0x000000, alpha: 0.85 });
                container.addChild(bg);

                const gameOverText = new PIXI.Text({
                    text: 'GAME OVER',
                    style: {
                        fontFamily: 'Arial Black, Arial',
                        fontSize: 48,
                        fill: 0xff3333,
                        fontWeight: 'bold'
                    }
                });
                gameOverText.anchor.set(0.5);
                gameOverText.x = CONFIG.width / 2;
                gameOverText.y = 180;
                container.addChild(gameOverText);

                // Score
                const scoreText = new PIXI.Text({
                    text: `Final Score: ${gameState.score}`,
                    style: { fontFamily: 'Arial', fontSize: 32, fill: 0xffffff }
                });
                scoreText.anchor.set(0.5);
                scoreText.x = CONFIG.width / 2;
                scoreText.y = 280;
                container.addChild(scoreText);

                // Wave
                const waveText = new PIXI.Text({
                    text: `Waves Survived: ${gameState.wave}`,
                    style: { fontFamily: 'Arial', fontSize: 24, fill: 0x00ffff }
                });
                waveText.anchor.set(0.5);
                waveText.x = CONFIG.width / 2;
                waveText.y = 330;
                container.addChild(waveText);

                // High score
                const highScore = parseInt(localStorage.getItem('spaceShooterHighScore') || '0');
                if (gameState.score > highScore) {
                    localStorage.setItem('spaceShooterHighScore', gameState.score.toString());

                    const newHighText = new PIXI.Text({
                        text: 'NEW HIGH SCORE!',
                        style: { fontFamily: 'Arial Black', fontSize: 24, fill: 0xFFD700 }
                    });
                    newHighText.anchor.set(0.5);
                    newHighText.x = CONFIG.width / 2;
                    newHighText.y = 390;
                    container.addChild(newHighText);
                }

                // Retry button
                const retryButton = createButton('RETRY', CONFIG.width / 2, 480, 0x00aa00, () => {
                    resetGame();
                    switchScene('game');
                });
                container.addChild(retryButton);

                // Menu button
                const menuButton = createButton('MENU', CONFIG.width / 2, 560, 0x3498db, () => {
                    switchScene('menu');
                });
                container.addChild(menuButton);
            }

            // ============================================
            // HELPER FUNCTIONS
            // ============================================
            function createButton(text, x, y, color, onClick) {
                const button = new PIXI.Container();
                button.x = x;
                button.y = y;

                const bg = new PIXI.Graphics();
                bg.roundRect(-90, -22, 180, 44, 22);
                bg.fill(color);
                button.addChild(bg);

                const label = new PIXI.Text({
                    text: text,
                    style: {
                        fontFamily: 'Arial Black, Arial',
                        fontSize: 20,
                        fill: 0xffffff,
                        fontWeight: 'bold'
                    }
                });
                label.anchor.set(0.5);
                button.addChild(label);

                button.eventMode = 'static';
                button.cursor = 'pointer';

                button.on('pointerdown', () => button.scale.set(0.95));
                button.on('pointerup', () => { button.scale.set(1); onClick(); });
                button.on('pointerupoutside', () => button.scale.set(1));

                return button;
            }

            function switchScene(sceneName) {
                if (currentScene) stage.removeChild(currentScene);

                switch (sceneName) {
                    case 'splash': createSplashScene(); break;
                    case 'loading': createLoadingScene(); break;
                    case 'menu': createMenuScene(); break;
                    case 'game': createGameScene(); break;
                    case 'gameOver': createGameOverScene(); break;
                }

                currentScene = scenes[sceneName];
                stage.addChild(currentScene);
            }

            function resetGame() {
                gameState.score = 0;
                gameState.lives = 3;
                gameState.wave = 1;
                gameState.bullets = [];
                gameState.enemies = [];
                gameState.powerUps = [];
                gameState.gameOver = false;
                gameState.lastFireTime = 0;
                gameState.lastSpawnTime = 0;
            }

            function triggerGameOver() {
                if (gameState.gameOver) return;
                gameState.gameOver = true;
                switchScene('gameOver');
            }

            function hitPlayer() {
                gameState.lives--;
                updateLivesDisplay();

                if (gameState.lives <= 0) {
                    triggerGameOver();
                } else {
                    // Flash player
                    playerSprite.tint = 0xff0000;
                    setTimeout(() => {
                        if (playerSprite) playerSprite.tint = 0xffffff;
                    }, 200);
                }
            }

            // ============================================
            // INPUT
            // ============================================
            inputManager.on('keydown', (event) => {
                switch (event.key) {
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        keys.left = true;
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        keys.right = true;
                        break;
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        keys.up = true;
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        keys.down = true;
                        break;
                    case ' ':
                        keys.fire = true;
                        break;
                }
            });

            inputManager.on('keyup', (event) => {
                switch (event.key) {
                    case 'ArrowLeft':
                    case 'a':
                    case 'A':
                        keys.left = false;
                        break;
                    case 'ArrowRight':
                    case 'd':
                    case 'D':
                        keys.right = false;
                        break;
                    case 'ArrowUp':
                    case 'w':
                    case 'W':
                        keys.up = false;
                        break;
                    case 'ArrowDown':
                    case 's':
                    case 'S':
                        keys.down = false;
                        break;
                    case ' ':
                        keys.fire = false;
                        break;
                }
            });

            // ============================================
            // UPDATE LOOP
            // ============================================
            game.on('update', (deltaTime) => {
                if (currentScene !== scenes.game || gameState.gameOver) return;

                const dt = deltaTime / 16.67; // Normalize to 60fps

                // Update stars
                if (starsContainer) {
                    for (const star of starsContainer.children) {
                        star.y += star.speed * dt;
                        if (star.y > CONFIG.height) {
                            star.y = 0;
                            star.x = Math.random() * CONFIG.width;
                        }
                    }
                }

                // Player movement
                if (playerSprite) {
                    if (keys.left) playerSprite.x -= CONFIG.playerSpeed * dt;
                    if (keys.right) playerSprite.x += CONFIG.playerSpeed * dt;
                    if (keys.up) playerSprite.y -= CONFIG.playerSpeed * dt;
                    if (keys.down) playerSprite.y += CONFIG.playerSpeed * dt;

                    // Bounds
                    playerSprite.x = Math.max(20, Math.min(CONFIG.width - 20, playerSprite.x));
                    playerSprite.y = Math.max(60, Math.min(CONFIG.height - 30, playerSprite.y));

                    // Fire
                    const now = Date.now();
                    if (keys.fire && now - gameState.lastFireTime > CONFIG.fireRate) {
                        createBullet(playerSprite.x, playerSprite.y - 25);
                        gameState.lastFireTime = now;
                    }
                }

                // Update bullets
                for (let i = gameState.bullets.length - 1; i >= 0; i--) {
                    const bullet = gameState.bullets[i];
                    bullet.y -= CONFIG.bulletSpeed * dt;

                    // Remove if off screen
                    if (bullet.y < -20) {
                        gameContainer.removeChild(bullet);
                        gameState.bullets.splice(i, 1);
                        continue;
                    }

                    // Check enemy collision
                    for (let j = gameState.enemies.length - 1; j >= 0; j--) {
                        const enemy = gameState.enemies[j];
                        const dx = bullet.x - enemy.x;
                        const dy = bullet.y - enemy.y;
                        if (Math.abs(dx) < 25 && Math.abs(dy) < 25) {
                            // Hit
                            enemy.health--;
                            gameContainer.removeChild(bullet);
                            gameState.bullets.splice(i, 1);

                            if (enemy.health <= 0) {
                                gameContainer.removeChild(enemy);
                                gameState.enemies.splice(j, 1);

                                // Score based on type
                                const points = enemy.type === 'tank' ? 300 : enemy.type === 'fast' ? 150 : 100;
                                gameState.score += points;
                                updateTopBar();

                                // Wave progression
                                if (gameState.score > gameState.wave * 1000) {
                                    gameState.wave++;
                                    updateTopBar();
                                }
                            }
                            break;
                        }
                    }
                }

                // Update enemies
                for (let i = gameState.enemies.length - 1; i >= 0; i--) {
                    const enemy = gameState.enemies[i];
                    const speed = enemy.type === 'fast' ? CONFIG.enemySpeed * 2 : CONFIG.enemySpeed;
                    enemy.y += speed * dt;

                    // Remove if off screen
                    if (enemy.y > CONFIG.height + 30) {
                        gameContainer.removeChild(enemy);
                        gameState.enemies.splice(i, 1);
                        continue;
                    }

                    // Check player collision
                    if (playerSprite) {
                        const dx = enemy.x - playerSprite.x;
                        const dy = enemy.y - playerSprite.y;
                        if (Math.abs(dx) < 25 && Math.abs(dy) < 30) {
                            gameContainer.removeChild(enemy);
                            gameState.enemies.splice(i, 1);
                            hitPlayer();
                        }
                    }
                }

                // Spawn enemies
                spawnWave();
            });

            // ============================================
            // START GAME
            // ============================================
            switchScene('splash');
            game.start();

        })();
    </script>
</body>
</html>
