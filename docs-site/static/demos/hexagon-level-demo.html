<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HexagonLevelButton Demo - GameByte Framework</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #4DA6FF; transition: background 0.3s ease; }
        body.light-theme { background: #87CEEB; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
    <script src="/gamebyte.umd.js"></script>

    <script>
        // =====================================================
        // HexagonLevelButton Demo - Using Framework Abstractions
        // =====================================================
        // This demo showcases:
        // - HexagonLevelButton with different styles
        // - Candy style and Classic style level buttons
        // - graphics() abstraction instead of direct PIXI usage
        // =====================================================

        const {
            createGame,
            HexagonLevelButton,
            GameStyleColors,
            graphics,
            loadFrameworkFont,
            Gradients
        } = GameByteFramework;

        const CONFIG = { width: 400, height: 450 };

        // ===== THEME DETECTION =====
        function detectTheme() {
            try {
                if (window.parent && window.parent.document) {
                    const parentTheme = window.parent.document.documentElement.getAttribute('data-theme');
                    if (parentTheme) return parentTheme;
                }
            } catch (e) { /* Cross-origin */ }

            const urlParams = new URLSearchParams(window.location.search);
            const themeParam = urlParams.get('theme');
            if (themeParam) return themeParam;

            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches) {
                return 'light';
            }
            return 'dark';
        }

        let currentTheme = detectTheme();

        function setupThemeListener() {
            try {
                if (window.parent && window.parent.document) {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.attributeName === 'data-theme') {
                                const newTheme = window.parent.document.documentElement.getAttribute('data-theme');
                                if (newTheme && newTheme !== currentTheme) {
                                    currentTheme = newTheme;
                                    applyTheme();
                                }
                            }
                        });
                    });
                    observer.observe(window.parent.document.documentElement, { attributes: true });
                }
            } catch (e) {
                window.matchMedia('(prefers-color-scheme: light)').addEventListener('change', (e) => {
                    currentTheme = e.matches ? 'light' : 'dark';
                    applyTheme();
                });
            }
        }

        // ===== THEME COLOR PALETTES =====
        const THEME_COLORS = {
            dark: {
                gradientTop: 0x4DA6FF,
                gradientBottom: 0x7DD3FF,
                textWhite: 0xffffff
            },
            light: {
                gradientTop: 0x87CEEB,
                gradientBottom: 0xB0E0E6,
                textWhite: 0x333333
            }
        };

        function getColors() {
            return THEME_COLORS[currentTheme] || THEME_COLORS.dark;
        }

        const canvas = document.createElement('canvas');
        canvas.width = CONFIG.width;
        canvas.height = CONFIG.height;
        document.body.appendChild(canvas);

        const game = createGame();
        let renderer, stage;

        let isRecreating = false;
        async function applyTheme() {
            if (isRecreating) return;
            isRecreating = true;

            document.body.classList.toggle('light-theme', currentTheme === 'light');
            if (stage && window.createScreen) {
                await loadFrameworkFont();
                window.createScreen();
            }
            setTimeout(() => { isRecreating = false; }, 100);
        }

        (async () => {
            await loadFrameworkFont();
            await game.initialize(canvas, '2d');
            renderer = game.make('renderer');
            stage = renderer.getStage();

            setupThemeListener();

            function createScreen() {
                const colors = getColors();
                const gfx = graphics();

                while (stage.children.length > 0) {
                    stage.removeChildAt(0);
                }

                // Sky gradient background using native FillGradient
                const bg = gfx.createGraphics();
                const skyGradient = Gradients.linear.vertical(colors.gradientTop, colors.gradientBottom);
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(skyGradient);
                stage.addChild(bg);

                // Title
                const title = gfx.createText('HexagonLevelButton', {
                    fontSize: 20,
                    fill: colors.textWhite
                });
                title.x = CONFIG.width / 2 - title.width / 2;
                title.y = 15;
                stage.addChild(title);

                // Row 1: Candy Crush Style
                const label1 = gfx.createText('Candy Style:', {
                    fontSize: 14,
                    fill: colors.textWhite
                });
                label1.x = 20;
                label1.y = 55;
                stage.addChild(label1);

                const candyCurrent = new HexagonLevelButton({
                    level: 17,
                    size: 70,
                    state: 'current',
                    colorScheme: GameStyleColors.HEXAGON_CANDY_CURRENT,
                    showStars: false
                });
                candyCurrent.setPosition(80, 130);
                stage.addChild(candyCurrent.getContainer());

                const candyAvailable = new HexagonLevelButton({
                    level: 18,
                    size: 70,
                    state: 'available',
                    colorScheme: GameStyleColors.HEXAGON_CANDY_BLUE,
                    showStars: false
                });
                candyAvailable.setPosition(170, 130);
                stage.addChild(candyAvailable.getContainer());

                const candyLocked = new HexagonLevelButton({
                    level: 19,
                    size: 70,
                    state: 'locked',
                    colorScheme: GameStyleColors.HEXAGON_CANDY_LOCKED,
                    showStars: false
                });
                candyLocked.setPosition(260, 130);
                stage.addChild(candyLocked.getContainer());

                // Row 2: Classic Style
                const label2 = gfx.createText('Classic Style:', {
                    fontSize: 14,
                    fill: colors.textWhite
                });
                label2.x = 20;
                label2.y = 190;
                stage.addChild(label2);

                const classicCurrent = new HexagonLevelButton({
                    level: 5,
                    size: 70,
                    state: 'current',
                    showStars: false
                });
                classicCurrent.setPosition(80, 265);
                stage.addChild(classicCurrent.getContainer());

                const classicCompleted = new HexagonLevelButton({
                    level: 4,
                    size: 70,
                    state: 'completed',
                    stars: 3,
                    showStars: true
                });
                classicCompleted.setPosition(170, 265);
                stage.addChild(classicCompleted.getContainer());

                const classicLocked = new HexagonLevelButton({
                    level: 6,
                    size: 70,
                    state: 'locked',
                    showStars: false
                });
                classicLocked.setPosition(260, 265);
                stage.addChild(classicLocked.getContainer());

                // Row 3: Small sizes
                const label3 = gfx.createText('Small Size:', {
                    fontSize: 14,
                    fill: colors.textWhite
                });
                label3.x = 20;
                label3.y = 330;
                stage.addChild(label3);

                for (let i = 0; i < 5; i++) {
                    const small = new HexagonLevelButton({
                        level: i + 1,
                        size: 50,
                        state: i < 3 ? 'completed' : i === 3 ? 'current' : 'locked',
                        colorScheme: GameStyleColors.HEXAGON_CANDY_BLUE,
                        showStars: false
                    });
                    small.setPosition(60 + i * 70, 390);
                    stage.addChild(small.getContainer());
                }

                // Click handlers
                [candyCurrent, candyAvailable, classicCurrent, classicCompleted].forEach(btn => {
                    btn.on('click', ({ level }) => console.log(`Level ${level} clicked!`));
                });
            }

            window.createScreen = createScreen;

            document.body.classList.toggle('light-theme', currentTheme === 'light');
            createScreen();
            game.start();
        })();
    </script>
</body>
</html>
