<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameModalPanel Demo - GameByte Framework</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #1a1a2e; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
    <script src="/gamebyte.umd.js"></script>

    <script>
        const { createGame, CelebrationManager } = GameByteFramework;

        const CONFIG = { width: 400, height: 500 };

        const canvas = document.createElement('canvas');
        canvas.width = CONFIG.width;
        canvas.height = CONFIG.height;
        document.body.appendChild(canvas);

        const game = createGame();
        let celebration = null;

        (async () => {
            await game.initialize(canvas, '2d');
            const renderer = game.make('renderer');
            const stage = renderer.getStage();

            // Create celebration manager
            celebration = new CelebrationManager(stage, CONFIG.width, CONFIG.height);

            // Background
            const bg = new PIXI.Graphics();
            bg.rect(0, 0, CONFIG.width, CONFIG.height);
            bg.fill(0x1a1a2e);
            stage.addChild(bg);

            // Background pattern (dots)
            for (let x = 0; x < CONFIG.width; x += 30) {
                for (let y = 0; y < CONFIG.height; y += 30) {
                    const dot = new PIXI.Graphics();
                    dot.circle(x, y, 2);
                    dot.fill({ color: 0xffffff, alpha: 0.1 });
                    stage.addChild(dot);
                }
            }

            // Show Modal button with glow effect
            const btnGlow = new PIXI.Graphics();
            btnGlow.roundRect(CONFIG.width / 2 - 85, CONFIG.height / 2 - 35, 170, 70, 16);
            btnGlow.fill({ color: 0x6366f1, alpha: 0.3 });
            stage.addChild(btnGlow);

            const showBtnBorder = new PIXI.Graphics();
            showBtnBorder.roundRect(CONFIG.width / 2 - 83, CONFIG.height / 2 - 33, 166, 66, 14);
            showBtnBorder.fill(0x4F51C5);
            stage.addChild(showBtnBorder);

            const showBtn = new PIXI.Graphics();
            showBtn.roundRect(CONFIG.width / 2 - 80, CONFIG.height / 2 - 30, 160, 60, 12);
            showBtn.fill(0x6366f1);
            showBtn.eventMode = 'static';
            showBtn.cursor = 'pointer';
            stage.addChild(showBtn);

            const showText = new PIXI.Text({
                text: 'Show Modal',
                style: { fontFamily: 'Arial', fontSize: 20, fontWeight: 'bold', fill: 0xffffff }
            });
            showText.anchor.set(0.5);
            showText.x = CONFIG.width / 2;
            showText.y = CONFIG.height / 2;
            stage.addChild(showText);

            // Modal overlay
            const modalOverlay = new PIXI.Container();
            modalOverlay.visible = false;
            stage.addChild(modalOverlay);

            // Dim background
            const dim = new PIXI.Graphics();
            dim.rect(0, 0, CONFIG.width, CONFIG.height);
            dim.fill({ color: 0x000000, alpha: 0.6 });
            dim.eventMode = 'static';
            modalOverlay.addChild(dim);

            // Modal panel
            const modal = new PIXI.Container();
            modal.x = CONFIG.width / 2;
            modal.y = CONFIG.height / 2;
            modalOverlay.addChild(modal);

            // Panel outer glow
            const panelGlow = new PIXI.Graphics();
            panelGlow.roundRect(-165, -185, 330, 370, 24);
            panelGlow.fill({ color: 0x6366f1, alpha: 0.2 });
            modal.addChild(panelGlow);

            // Panel background with border
            const panelBorder = new PIXI.Graphics();
            panelBorder.roundRect(-158, -178, 316, 356, 20);
            panelBorder.fill(0x4d4d6c);
            modal.addChild(panelBorder);

            const panelBg = new PIXI.Graphics();
            panelBg.roundRect(-150, -170, 300, 340, 16);
            panelBg.fill(0x2A3142);
            modal.addChild(panelBg);

            // Title with decoration
            const titleDecorLeft = new PIXI.Graphics();
            titleDecorLeft.roundRect(-130, -132, 40, 3, 2);
            titleDecorLeft.fill(0x6366f1);
            modal.addChild(titleDecorLeft);

            const titleDecorRight = new PIXI.Graphics();
            titleDecorRight.roundRect(90, -132, 40, 3, 2);
            titleDecorRight.fill(0x6366f1);
            modal.addChild(titleDecorRight);

            const title = new PIXI.Text({
                text: 'Settings',
                style: {
                    fontFamily: 'Arial',
                    fontSize: 28,
                    fontWeight: 'bold',
                    fill: 0xffffff,
                    dropShadow: true,
                    dropShadowDistance: 2
                }
            });
            title.anchor.set(0.5);
            title.y = -130;
            modal.addChild(title);

            // Settings icon
            const settingsIcon = new PIXI.Text({
                text: 'âš™ï¸',
                style: { fontSize: 24 }
            });
            settingsIcon.anchor.set(0.5);
            settingsIcon.x = -70;
            settingsIcon.y = -130;
            modal.addChild(settingsIcon);

            // Close button with glow
            const closeBtnGlow = new PIXI.Graphics();
            closeBtnGlow.circle(125, -145, 22);
            closeBtnGlow.fill({ color: 0xE84C4C, alpha: 0.3 });
            modal.addChild(closeBtnGlow);

            const closeBtn = new PIXI.Graphics();
            closeBtn.circle(125, -145, 18);
            closeBtn.fill(0xE84C4C);
            closeBtn.eventMode = 'static';
            closeBtn.cursor = 'pointer';
            modal.addChild(closeBtn);

            const closeX = new PIXI.Text({
                text: 'âœ•',
                style: { fontFamily: 'Arial', fontSize: 18, fontWeight: 'bold', fill: 0xffffff }
            });
            closeX.anchor.set(0.5);
            closeX.x = 125;
            closeX.y = -145;
            modal.addChild(closeX);

            // Content - toggles
            const toggles = [
                { label: 'Music', icon: 'ðŸŽµ', value: true, y: -60 },
                { label: 'Sound Effects', icon: 'ðŸ”Š', value: true, y: 10 },
                { label: 'Vibration', icon: 'ðŸ“³', value: false, y: 80 }
            ];

            toggles.forEach((toggle) => {
                // Row background
                const rowBg = new PIXI.Graphics();
                rowBg.roundRect(-130, toggle.y - 18, 260, 50, 10);
                rowBg.fill({ color: 0x3d3d5c, alpha: 0.5 });
                modal.addChild(rowBg);

                // Icon
                const icon = new PIXI.Text({
                    text: toggle.icon,
                    style: { fontSize: 20 }
                });
                icon.x = -110;
                icon.y = toggle.y - 2;
                modal.addChild(icon);

                // Label
                const label = new PIXI.Text({
                    text: toggle.label,
                    style: { fontFamily: 'Arial', fontSize: 18, fill: 0xffffff }
                });
                label.x = -80;
                label.y = toggle.y;
                modal.addChild(label);

                // Toggle background with border
                const toggleBorder = new PIXI.Graphics();
                toggleBorder.roundRect(68, toggle.y - 7, 64, 34, 17);
                toggleBorder.fill(toggle.value ? 0x2E7D32 : 0x3d3d5c);
                modal.addChild(toggleBorder);

                const toggleBg = new PIXI.Graphics();
                toggleBg.roundRect(70, toggle.y - 5, 60, 30, 15);
                toggleBg.fill(toggle.value ? 0x4CAF50 : 0x4b5563);
                toggleBg.eventMode = 'static';
                toggleBg.cursor = 'pointer';
                modal.addChild(toggleBg);

                // Toggle knob with shadow
                const knobShadow = new PIXI.Graphics();
                knobShadow.circle(toggle.value ? 116 : 86, toggle.y + 11, 11);
                knobShadow.fill({ color: 0x000000, alpha: 0.2 });
                modal.addChild(knobShadow);

                const knob = new PIXI.Graphics();
                knob.circle(toggle.value ? 115 : 85, toggle.y + 10, 11);
                knob.fill(0xffffff);
                modal.addChild(knob);

                toggleBg.on('pointerdown', () => {
                    toggle.value = !toggle.value;

                    // Update border
                    toggleBorder.clear();
                    toggleBorder.roundRect(68, toggle.y - 7, 64, 34, 17);
                    toggleBorder.fill(toggle.value ? 0x2E7D32 : 0x3d3d5c);

                    // Update background
                    toggleBg.clear();
                    toggleBg.roundRect(70, toggle.y - 5, 60, 30, 15);
                    toggleBg.fill(toggle.value ? 0x4CAF50 : 0x4b5563);

                    // Update knob
                    knobShadow.clear();
                    knobShadow.circle(toggle.value ? 116 : 86, toggle.y + 11, 11);
                    knobShadow.fill({ color: 0x000000, alpha: 0.2 });

                    knob.clear();
                    knob.circle(toggle.value ? 115 : 85, toggle.y + 10, 11);
                    knob.fill(0xffffff);

                    // Sparkle effect when enabled
                    if (toggle.value) {
                        const sparkleX = modal.x + 100;
                        const sparkleY = modal.y + toggle.y + 10;
                        celebration.rewardReceived(sparkleX, sparkleY);
                    }
                });
            });

            // Animation functions
            function easeOutBack(x) {
                const c1 = 1.70158;
                const c3 = c1 + 1;
                return 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2);
            }

            function animate(target, props, duration, easing = (x) => x) {
                return new Promise(resolve => {
                    const start = {};
                    for (const key in props) {
                        start[key] = target[key];
                    }
                    const startTime = Date.now();

                    const tick = () => {
                        const elapsed = Date.now() - startTime;
                        const progress = Math.min(elapsed / duration, 1);
                        const eased = easing(progress);

                        for (const key in props) {
                            target[key] = start[key] + (props[key] - start[key]) * eased;
                        }

                        if (progress < 1) {
                            requestAnimationFrame(tick);
                        } else {
                            resolve();
                        }
                    };
                    tick();
                });
            }

            async function showModal() {
                modalOverlay.visible = true;
                dim.alpha = 0;
                modal.scale.x = 0;
                modal.scale.y = 0;

                await Promise.all([
                    animate(dim, { alpha: 0.6 }, 200),
                    animate(modal.scale, { x: 1, y: 1 }, 300, easeOutBack)
                ]);

                // Small burst celebration when modal opens
                celebration.confetti.burst(CONFIG.width / 2, CONFIG.height / 2, {
                    particleCount: 20,
                    spread: 360,
                    colors: [0x6366f1, 0x8B5CF6, 0xffffff]
                });
            }

            async function hideModal() {
                await Promise.all([
                    animate(dim, { alpha: 0 }, 150),
                    animate(modal.scale, { x: 0, y: 0 }, 200)
                ]);
                modalOverlay.visible = false;
            }

            showBtn.on('pointerdown', showModal);
            closeBtn.on('pointerdown', hideModal);
            dim.on('pointerdown', hideModal);

            // Instructions
            const instr = new PIXI.Text({
                text: 'Tap to show modal with scale animation',
                style: { fontFamily: 'Arial', fontSize: 12, fill: 0x888888 }
            });
            instr.anchor.set(0.5);
            instr.x = CONFIG.width / 2;
            instr.y = CONFIG.height - 30;
            stage.addChild(instr);

            // Game loop for celebration updates
            game.on('update', (deltaTime) => {
                celebration.update(deltaTime);
            });

            game.start();
        })();
    </script>
</body>
</html>
