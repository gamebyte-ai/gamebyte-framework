<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ResultScreen Demo - GameByte Framework</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #1c2333; }
        canvas { display: block; margin: 0 auto; }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
    <script src="/gamebyte.umd.js"></script>

    <script>
        const { createGame, CelebrationManager } = GameByteFramework;

        const CONFIG = { width: 360, height: 700 };

        // Pixel-perfect color palette from reference
        const COLORS = {
            // Background
            darkBg: 0x1c2333,

            // Light rays
            rayColor: 0x2a3f5f,
            rayAlpha: 0.35,

            // Trophy glow (olive-yellow tones)
            glowOuter: 0xa5a845,
            glowMiddle: 0xb8b850,
            glowInner: 0xd4d870,

            // Main panel
            panelBg: 0x4a7ab5,
            panelBorder: 0x2a4a75,
            panelGradientTop: 0x5a8ac5,
            panelGradientBottom: 0x3a6a95,

            // Banner
            bannerBlue: 0x5ab0e8,
            bannerLight: 0x7ac8f8,
            bannerDark: 0x3a90c8,

            // Reward panel
            rewardPanelBg: 0x5a8ab8,
            rewardPanelBorder: 0x3a5a85,

            // Buttons
            greenBtn: 0x6ac46a,
            greenBtnShadow: 0x3a8a3a,
            greenBtnHighlight: 0x8ae88a,

            orangeBtn: 0xe8c878,
            orangeBtnShadow: 0xc8a050,
            orangeBtnHighlight: 0xf8e0a0,

            // Text
            textWhite: 0xffffff,
            textOutline: 0x2a4a6a,
            textDark: 0x4a5a6a,

            // Coin display
            coinDisplayBg: 0x3a4a6a,
            plusButton: 0xe8a040
        };

        const canvas = document.createElement('canvas');
        canvas.width = CONFIG.width;
        canvas.height = CONFIG.height;
        document.body.appendChild(canvas);

        const game = createGame();
        let celebration = null;

        // ===== LIGHT RAYS HELPER =====
        // Creates trapezoid-shaped light rays (not triangles!)
        function createLightRays(config) {
            const container = new PIXI.Container();
            const {
                rayCount = 16,
                innerRadius = 20,
                outerRadius = 350,
                innerWidth = 0.08,  // Angular width at center (radians)
                outerWidth = 0.12,  // Angular width at edge (radians)
                color = COLORS.rayColor,
                alpha = COLORS.rayAlpha
            } = config;

            for (let i = 0; i < rayCount; i++) {
                const angle = (i / rayCount) * Math.PI * 2;

                const ray = new PIXI.Graphics();

                // Trapezoid points (clockwise from inner-left)
                const innerLeft = {
                    x: Math.cos(angle - innerWidth / 2) * innerRadius,
                    y: Math.sin(angle - innerWidth / 2) * innerRadius
                };
                const innerRight = {
                    x: Math.cos(angle + innerWidth / 2) * innerRadius,
                    y: Math.sin(angle + innerWidth / 2) * innerRadius
                };
                const outerRight = {
                    x: Math.cos(angle + outerWidth / 2) * outerRadius,
                    y: Math.sin(angle + outerWidth / 2) * outerRadius
                };
                const outerLeft = {
                    x: Math.cos(angle - outerWidth / 2) * outerRadius,
                    y: Math.sin(angle - outerWidth / 2) * outerRadius
                };

                ray.poly([
                    innerLeft.x, innerLeft.y,
                    innerRight.x, innerRight.y,
                    outerRight.x, outerRight.y,
                    outerLeft.x, outerLeft.y
                ]);
                ray.fill({ color, alpha });
                container.addChild(ray);
            }

            return container;
        }

        // ===== MULTI-LAYER GLOW HELPER =====
        function createGlow() {
            const container = new PIXI.Container();

            // Outer glow layer
            const outer = new PIXI.Graphics();
            outer.circle(0, 0, 100);
            outer.fill({ color: COLORS.glowOuter, alpha: 0.25 });
            container.addChild(outer);

            // Middle glow layer
            const middle = new PIXI.Graphics();
            middle.circle(0, 0, 70);
            middle.fill({ color: COLORS.glowMiddle, alpha: 0.5 });
            container.addChild(middle);

            // Inner glow layer (brightest)
            const inner = new PIXI.Graphics();
            inner.circle(0, 0, 50);
            inner.fill({ color: COLORS.glowInner, alpha: 0.8 });
            container.addChild(inner);

            return container;
        }

        // ===== 3D BUTTON HELPER =====
        function create3DButton(x, y, width, height, config) {
            const container = new PIXI.Container();
            const { mainColor, shadowColor, highlightColor } = config;

            // Shadow layer (bottom)
            const shadow = new PIXI.Graphics();
            shadow.roundRect(x, y + 4, width, height, 12);
            shadow.fill(shadowColor);
            container.addChild(shadow);

            // Main button
            const btn = new PIXI.Graphics();
            btn.roundRect(x, y, width, height, 12);
            btn.fill(mainColor);
            btn.eventMode = 'static';
            btn.cursor = 'pointer';
            container.addChild(btn);

            // Highlight layer (top)
            const highlight = new PIXI.Graphics();
            highlight.roundRect(x + 5, y + 3, width - 10, 15, 8);
            highlight.fill({ color: highlightColor, alpha: 0.4 });
            container.addChild(highlight);

            container.mainBtn = btn;
            return container;
        }

        (async () => {
            await game.initialize(canvas, '2d');
            const renderer = game.make('renderer');
            const stage = renderer.getStage();

            celebration = new CelebrationManager(stage, CONFIG.width, CONFIG.height);

            function createVictoryScreen() {
                // Clear stage
                while (stage.children.length > 0) {
                    stage.removeChildAt(0);
                }
                celebration.clear();

                const centerX = CONFIG.width / 2;

                // ===== DARK BACKGROUND =====
                const bg = new PIXI.Graphics();
                bg.rect(0, 0, CONFIG.width, CONFIG.height);
                bg.fill(COLORS.darkBg);
                stage.addChild(bg);

                // ===== TROPHY LIGHT RAYS (Behind everything, very long!) =====
                const trophyY = 110;

                const trophyRays = createLightRays({
                    rayCount: 16,
                    innerRadius: 15,
                    outerRadius: 350,
                    innerWidth: 0.06,
                    outerWidth: 0.14
                });
                trophyRays.x = centerX;
                trophyRays.y = trophyY + 40;
                stage.addChild(trophyRays);

                // Animate rays slowly
                game.on('update', () => {
                    trophyRays.rotation += 0.002;
                });

                // ===== TROPHY GLOW (3-layer olive-yellow) =====
                const trophyGlow = createGlow();
                trophyGlow.x = centerX;
                trophyGlow.y = trophyY + 40;
                stage.addChild(trophyGlow);

                // ===== TOP RIGHT COIN DISPLAY =====
                const coinDisplay = new PIXI.Container();
                coinDisplay.x = CONFIG.width - 80;
                coinDisplay.y = 25;
                stage.addChild(coinDisplay);

                // Pill background
                const coinBg = new PIXI.Graphics();
                coinBg.roundRect(-50, -15, 100, 30, 15);
                coinBg.fill(COLORS.coinDisplayBg);
                coinDisplay.addChild(coinBg);

                // Coin icon
                const coinIcon = new PIXI.Text({ text: 'ðŸª™', style: { fontSize: 22 } });
                coinIcon.anchor.set(0.5);
                coinIcon.x = -32;
                coinDisplay.addChild(coinIcon);

                // Amount text
                const coinAmount = new PIXI.Text({
                    text: '1460',
                    style: { fontFamily: 'Arial', fontSize: 16, fontWeight: 'bold', fill: COLORS.textWhite }
                });
                coinAmount.anchor.set(0, 0.5);
                coinAmount.x = -16;
                coinDisplay.addChild(coinAmount);

                // Plus button (orange circle)
                const plusBtn = new PIXI.Graphics();
                plusBtn.circle(35, 0, 12);
                plusBtn.fill(COLORS.plusButton);
                coinDisplay.addChild(plusBtn);

                const plusText = new PIXI.Text({
                    text: '+',
                    style: { fontFamily: 'Arial', fontSize: 18, fontWeight: 'bold', fill: COLORS.textWhite }
                });
                plusText.anchor.set(0.5);
                plusText.x = 35;
                coinDisplay.addChild(plusText);

                // ===== MAIN PANEL (Blue rounded rectangle) =====
                const panelY = 100;
                const panelWidth = 300;
                const panelHeight = 480;
                const panelX = centerX - panelWidth / 2;

                // Panel border (dark outer)
                const panelBorder = new PIXI.Graphics();
                panelBorder.roundRect(panelX - 4, panelY - 4, panelWidth + 8, panelHeight + 8, 28);
                panelBorder.fill(COLORS.panelBorder);
                stage.addChild(panelBorder);

                // Panel main background
                const panelBg = new PIXI.Graphics();
                panelBg.roundRect(panelX, panelY, panelWidth, panelHeight, 25);
                panelBg.fill(COLORS.panelBg);
                stage.addChild(panelBg);

                // Panel gradient overlay (darker at bottom)
                const panelGradient = new PIXI.Graphics();
                panelGradient.roundRect(panelX, panelY + panelHeight * 0.6, panelWidth, panelHeight * 0.4, 25);
                panelGradient.fill({ color: COLORS.panelGradientBottom, alpha: 0.4 });
                stage.addChild(panelGradient);

                // Panel top highlight line
                const panelHighlight = new PIXI.Graphics();
                panelHighlight.roundRect(panelX + 10, panelY + 5, panelWidth - 20, 4, 2);
                panelHighlight.fill({ color: 0xffffff, alpha: 0.15 });
                stage.addChild(panelHighlight);

                // ===== TROPHY EMOJI =====
                const trophy = new PIXI.Text({ text: 'ðŸ†', style: { fontSize: 72 } });
                trophy.anchor.set(0.5);
                trophy.x = centerX;
                trophy.y = trophyY + 40;
                stage.addChild(trophy);

                // ===== LEVEL COMPLETED BANNER =====
                const ribbonY = panelY + 100;
                const ribbonWidth = 260;
                const ribbonHeight = 55;

                // Banner shadow (3D bottom)
                const bannerShadow = new PIXI.Graphics();
                bannerShadow.roundRect(centerX - ribbonWidth/2, ribbonY + 3, ribbonWidth, ribbonHeight, 8);
                bannerShadow.fill(COLORS.bannerDark);
                stage.addChild(bannerShadow);

                // Banner main body
                const banner = new PIXI.Graphics();
                banner.roundRect(centerX - ribbonWidth/2, ribbonY, ribbonWidth, ribbonHeight - 3, 8);
                banner.fill(COLORS.bannerBlue);
                stage.addChild(banner);

                // Banner top highlight
                const bannerHighlight = new PIXI.Graphics();
                bannerHighlight.roundRect(centerX - ribbonWidth/2 + 5, ribbonY + 2, ribbonWidth - 10, 3, 2);
                bannerHighlight.fill(COLORS.bannerLight);
                stage.addChild(bannerHighlight);

                // Left ribbon end (folded trapezoid)
                const leftRibbon = new PIXI.Graphics();
                leftRibbon.poly([
                    centerX - ribbonWidth/2 - 10, ribbonY + 8,     // Outer top
                    centerX - ribbonWidth/2, ribbonY + 8,          // Inner top
                    centerX - ribbonWidth/2, ribbonY + 47,         // Inner bottom
                    centerX - ribbonWidth/2 - 10, ribbonY + 47,    // Outer bottom
                    centerX - ribbonWidth/2, ribbonY + 27          // Fold point (inward)
                ]);
                leftRibbon.fill(COLORS.bannerDark);
                stage.addChild(leftRibbon);

                // Right ribbon end (folded trapezoid)
                const rightRibbon = new PIXI.Graphics();
                rightRibbon.poly([
                    centerX + ribbonWidth/2 + 10, ribbonY + 8,     // Outer top
                    centerX + ribbonWidth/2, ribbonY + 8,          // Inner top
                    centerX + ribbonWidth/2, ribbonY + 47,         // Inner bottom
                    centerX + ribbonWidth/2 + 10, ribbonY + 47,    // Outer bottom
                    centerX + ribbonWidth/2, ribbonY + 27          // Fold point (inward)
                ]);
                rightRibbon.fill(COLORS.bannerDark);
                stage.addChild(rightRibbon);

                // "LEVEL 20" text
                const levelText = new PIXI.Text({
                    text: 'LEVEL 20',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 24,
                        fontWeight: 'bold',
                        fill: COLORS.textWhite,
                        dropShadow: true,
                        dropShadowColor: 0x000000,
                        dropShadowDistance: 2,
                        dropShadowBlur: 2
                    }
                });
                levelText.anchor.set(0.5);
                levelText.x = centerX;
                levelText.y = ribbonY + 18;
                stage.addChild(levelText);

                // "COMPLETED!" text
                const completedText = new PIXI.Text({
                    text: 'COMPLETED!',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 12,
                        fontWeight: 'bold',
                        fill: COLORS.textWhite,
                        dropShadow: true,
                        dropShadowColor: 0x000000,
                        dropShadowDistance: 2,
                        dropShadowBlur: 2
                    }
                });
                completedText.anchor.set(0.5);
                completedText.x = centerX;
                completedText.y = ribbonY + 38;
                stage.addChild(completedText);

                // ===== REWARDS TITLE =====
                const rewardsY = ribbonY + 75;

                const rewardsTitle = new PIXI.Text({
                    text: 'REWARDS',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 22,
                        fontWeight: 'bold',
                        fill: COLORS.textWhite,
                        stroke: { color: COLORS.textOutline, width: 5 }
                    }
                });
                rewardsTitle.anchor.set(0.5);
                rewardsTitle.x = centerX;
                rewardsTitle.y = rewardsY;
                stage.addChild(rewardsTitle);

                // ===== REWARD PANEL (Inner panel with coin) =====
                const rewardPanelY = rewardsY + 25;
                const rewardPanelWidth = 260;
                const rewardPanelHeight = 140;
                const rewardPanelX = centerX - rewardPanelWidth / 2;

                // Reward panel border
                const rewardBorder = new PIXI.Graphics();
                rewardBorder.roundRect(rewardPanelX - 3, rewardPanelY - 3, rewardPanelWidth + 6, rewardPanelHeight + 6, 18);
                rewardBorder.fill(COLORS.rewardPanelBorder);
                stage.addChild(rewardBorder);

                // Reward panel background
                const rewardPanel = new PIXI.Graphics();
                rewardPanel.roundRect(rewardPanelX, rewardPanelY, rewardPanelWidth, rewardPanelHeight, 15);
                rewardPanel.fill(COLORS.rewardPanelBg);
                stage.addChild(rewardPanel);

                // Coin light rays (inside reward panel)
                const coinRays = createLightRays({
                    rayCount: 18,
                    innerRadius: 10,
                    outerRadius: 90,
                    innerWidth: 0.05,
                    outerWidth: 0.10
                });
                coinRays.x = centerX;
                coinRays.y = rewardPanelY + 55;
                stage.addChild(coinRays);

                // Animate coin rays (opposite direction)
                game.on('update', () => {
                    coinRays.rotation -= 0.003;
                });

                // Coin container (for shimmer effect)
                const rewardCoinContainer = new PIXI.Container();
                rewardCoinContainer.x = centerX;
                rewardCoinContainer.y = rewardPanelY + 50;
                stage.addChild(rewardCoinContainer);

                // Large reward coin
                const rewardCoin = new PIXI.Text({ text: 'ðŸª™', style: { fontSize: 56 } });
                rewardCoin.anchor.set(0.5);
                rewardCoinContainer.addChild(rewardCoin);

                // Add shimmer effect
                setTimeout(() => {
                    celebration.addShimmer(rewardCoinContainer, 'gold');
                }, 500);

                // Reward amount "40"
                const rewardAmount = new PIXI.Text({
                    text: '40',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 40,
                        fontWeight: 'bold',
                        fill: COLORS.textWhite,
                        stroke: { color: COLORS.textOutline, width: 5 }
                    }
                });
                rewardAmount.anchor.set(0.5);
                rewardAmount.x = centerX;
                rewardAmount.y = rewardPanelY + 112;
                stage.addChild(rewardAmount);

                // ===== BUTTONS =====
                const btnY = rewardPanelY + rewardPanelHeight + 30;
                const btnWidth = 120;
                const btnHeight = 50;
                const btnGap = 20;

                // Continue button (green, 3D)
                const continueBtn = create3DButton(
                    centerX - btnWidth - btnGap/2, btnY, btnWidth, btnHeight,
                    {
                        mainColor: COLORS.greenBtn,
                        shadowColor: COLORS.greenBtnShadow,
                        highlightColor: COLORS.greenBtnHighlight
                    }
                );
                stage.addChild(continueBtn);

                const continueText = new PIXI.Text({
                    text: 'Continue',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 18,
                        fontWeight: 'bold',
                        fill: COLORS.textWhite,
                        dropShadow: true,
                        dropShadowColor: 0x000000,
                        dropShadowDistance: 1,
                        dropShadowBlur: 1
                    }
                });
                continueText.anchor.set(0.5);
                continueText.x = centerX - btnWidth/2 - btnGap/2;
                continueText.y = btnY + btnHeight/2;
                stage.addChild(continueText);

                // Watch Ad button (beige-orange, 3D)
                const adBtn = create3DButton(
                    centerX + btnGap/2, btnY, btnWidth, btnHeight,
                    {
                        mainColor: COLORS.orangeBtn,
                        shadowColor: COLORS.orangeBtnShadow,
                        highlightColor: COLORS.orangeBtnHighlight
                    }
                );
                stage.addChild(adBtn);

                // Clapperboard icon
                const videoIcon = new PIXI.Text({ text: 'ðŸŽ¬', style: { fontSize: 18 } });
                videoIcon.anchor.set(0.5);
                videoIcon.x = centerX + btnGap/2 + 20;
                videoIcon.y = btnY + btnHeight/2;
                stage.addChild(videoIcon);

                // "80" text (darker color for contrast on beige)
                const adAmountText = new PIXI.Text({
                    text: '80',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 18,
                        fontWeight: 'bold',
                        fill: COLORS.textDark
                    }
                });
                adAmountText.anchor.set(0.5);
                adAmountText.x = centerX + btnGap/2 + 55;
                adAmountText.y = btnY + btnHeight/2 - 3;
                stage.addChild(adAmountText);

                // Small coin icon
                const smallCoin = new PIXI.Text({ text: 'ðŸª™', style: { fontSize: 14 } });
                smallCoin.anchor.set(0.5);
                smallCoin.x = centerX + btnGap/2 + 82;
                smallCoin.y = btnY + btnHeight/2 - 3;
                stage.addChild(smallCoin);

                // x2 badge (red-orange)
                const x2Badge = new PIXI.Text({
                    text: 'x2',
                    style: {
                        fontFamily: 'Arial',
                        fontSize: 11,
                        fontWeight: 'bold',
                        fill: 0xe85050
                    }
                });
                x2Badge.anchor.set(0.5);
                x2Badge.x = centerX + btnGap/2 + 100;
                x2Badge.y = btnY + btnHeight/2 + 8;
                stage.addChild(x2Badge);

                // ===== VICTORY CONFETTI =====
                setTimeout(() => {
                    celebration.victory();
                }, 300);

                // Button hover effects
                continueBtn.mainBtn.on('pointerover', () => continueBtn.mainBtn.tint = 0xccffcc);
                continueBtn.mainBtn.on('pointerout', () => continueBtn.mainBtn.tint = 0xffffff);
                adBtn.mainBtn.on('pointerover', () => adBtn.mainBtn.tint = 0xffffee);
                adBtn.mainBtn.on('pointerout', () => adBtn.mainBtn.tint = 0xffffff);
            }

            // Game loop for celebration updates
            game.on('update', (deltaTime) => {
                celebration.update(deltaTime);
            });

            createVictoryScreen();
            game.start();
        })();
    </script>
</body>
</html>
