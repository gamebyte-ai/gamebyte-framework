<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GameByte - First Game Demo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 {
            color: #fff;
            margin-bottom: 10px;
            font-size: 24px;
        }
        p {
            color: #8892b0;
            margin-bottom: 20px;
            font-size: 14px;
        }
        #game-container {
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
        }
        canvas { display: block; }
        .info {
            color: #8892b0;
            margin-top: 20px;
            font-size: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Your First Game</h1>
    <p>Simple coin collector game built with GameByte Framework</p>
    <div id="game-container"></div>
    <div class="info">
        üéÆ Click/tap to move the player and collect coins!
    </div>

    <script src="https://cdn.jsdelivr.net/npm/pixi.js@8/dist/pixi.min.js"></script>
    <script src="../gamebyte.umd.js"></script>

    <script>
        const {
            createGame,
            GameStyleButton,
            GameStyleColors,
            loadFrameworkFont,
            getFrameworkFontFamily,
            graphics
        } = window.GameByteFramework;

        const CONFIG = { width: 500, height: 550 };

        const canvas = document.createElement('canvas');
        canvas.width = CONFIG.width;
        canvas.height = CONFIG.height;
        document.getElementById('game-container').appendChild(canvas);

        const game = createGame();
        let renderer, stage, factory;

        // Game state
        let player, targetPos;
        let coins = [];
        let score = 0;
        let gameOver = false;
        let timeLeft = 30;

        // UI elements
        let scoreText, timerText, messageText;

        async function init() {
            await loadFrameworkFont();
            await game.initialize(canvas, '2d');
            renderer = game.make('renderer');
            stage = renderer.getStage();
            factory = graphics();

            // Background
            const bg = factory.createGraphics();
            bg.rect(0, 0, CONFIG.width, CONFIG.height);
            bg.fill({ color: 0x1a1a2e });
            stage.addChild(bg);

            // Game area
            const gameArea = factory.createGraphics();
            gameArea.roundRect(20, 80, 460, 360, 8);
            gameArea.fill({ color: 0x0a0a1a, alpha: 0.6 });
            gameArea.stroke({ color: 0x3D4F5F, width: 2 });
            stage.addChild(gameArea);

            // Create UI
            createUI();

            // Create player
            createPlayer();

            // Spawn initial coins
            for (let i = 0; i < 5; i++) {
                spawnCoin();
            }

            // Setup interaction
            stage.eventMode = 'static';
            stage.hitArea = { contains: () => true };
            stage.on('pointerdown', onPointerDown);

            // Setup game loop
            game.on('update', (deltaTime) => {
                if (!gameOver) {
                    update(deltaTime);
                }
            });

            // Timer
            setInterval(() => {
                if (!gameOver && timeLeft > 0) {
                    timeLeft--;
                    timerText.text = `‚è± ${timeLeft}s`;
                    if (timeLeft <= 10) {
                        timerText.style.fill = 0xE74C3C;
                    }
                    if (timeLeft === 0) {
                        endGame();
                    }
                }
            }, 1000);

            game.start();
            console.log('First game demo initialized!');
        }

        function createUI() {
            // Title
            const title = factory.createText('üéÆ Coin Collector', {
                fontFamily: getFrameworkFontFamily(),
                fontSize: 28,
                fill: 0xFFFFFF
            });
            title.x = CONFIG.width / 2;
            title.y = 15;
            if (title.anchor) title.anchor.set(0.5, 0);
            stage.addChild(title);

            // Score
            scoreText = factory.createText('ü™ô Score: 0', {
                fontFamily: getFrameworkFontFamily(),
                fontSize: 20,
                fill: 0xFFD700
            });
            scoreText.x = 30;
            scoreText.y = 50;
            stage.addChild(scoreText);

            // Timer
            timerText = factory.createText(`‚è± ${timeLeft}s`, {
                fontFamily: getFrameworkFontFamily(),
                fontSize: 20,
                fill: 0x5DADE2
            });
            timerText.x = 400;
            timerText.y = 50;
            stage.addChild(timerText);

            // Instructions
            const instructions = factory.createText('Click/tap to move!', {
                fontSize: 14,
                fill: 0x8892b0
            });
            instructions.x = CONFIG.width / 2;
            instructions.y = 455;
            if (instructions.anchor) instructions.anchor.set(0.5, 0);
            stage.addChild(instructions);

            // Play again button (hidden initially)
            const playAgainBtn = new GameStyleButton({
                text: 'üîÑ Play Again',
                width: 180,
                height: 60,
                fontSize: 20,
                colorScheme: GameStyleColors.GREEN_BUTTON
            });
            playAgainBtn.setPosition(160, 480);
            playAgainBtn.on('click', resetGame);
            playAgainBtn.getContainer().visible = false;
            stage.addChild(playAgainBtn.getContainer());
            window.playAgainBtn = playAgainBtn;

            // Game over message (hidden initially)
            messageText = factory.createText('', {
                fontFamily: getFrameworkFontFamily(),
                fontSize: 36,
                fill: 0xFFFFFF,
                stroke: { color: 0x000000, width: 4 }
            });
            messageText.x = CONFIG.width / 2;
            messageText.y = 200;
            if (messageText.anchor) messageText.anchor.set(0.5, 0.5);
            messageText.visible = false;
            stage.addChild(messageText);
        }

        function createPlayer() {
            player = factory.createGraphics();

            // Body
            player.circle(0, 0, 20);
            player.fill({ color: 0x3498DB });

            // Face
            player.circle(-6, -5, 4);
            player.fill({ color: 0xFFFFFF });
            player.circle(6, -5, 4);
            player.fill({ color: 0xFFFFFF });

            // Pupils
            player.circle(-5, -4, 2);
            player.fill({ color: 0x000000 });
            player.circle(7, -4, 2);
            player.fill({ color: 0x000000 });

            // Smile
            player.arc(0, 2, 8, 0.2, Math.PI - 0.2);
            player.stroke({ color: 0xFFFFFF, width: 2 });

            player.x = 250;
            player.y = 260;
            targetPos = { x: player.x, y: player.y };
            stage.addChild(player);
        }

        function spawnCoin() {
            const coin = factory.createGraphics();

            // Coin body
            coin.circle(0, 0, 15);
            coin.fill({ color: 0xFFD700 });

            // Inner circle
            coin.circle(0, 0, 10);
            coin.stroke({ color: 0xB8860B, width: 2 });

            // Dollar sign
            coin.moveTo(-3, -6);
            coin.lineTo(-3, 6);
            coin.lineTo(3, 6);
            coin.stroke({ color: 0xB8860B, width: 2 });

            // Random position within game area
            coin.x = 50 + Math.random() * 400;
            coin.y = 110 + Math.random() * 300;

            coin.scale.set(0);
            coins.push(coin);
            stage.addChild(coin);

            // Spawn animation
            animateSpawn(coin);
        }

        function animateSpawn(obj) {
            let scale = 0;
            const animate = () => {
                scale += 0.1;
                if (scale >= 1) {
                    obj.scale.set(1);
                    return;
                }
                obj.scale.set(scale);
                requestAnimationFrame(animate);
            };
            animate();
        }

        function onPointerDown(event) {
            if (gameOver) return;

            const pos = event.global || event.data?.global;
            if (!pos) return;

            // Clamp to game area
            targetPos.x = Math.max(50, Math.min(450, pos.x));
            targetPos.y = Math.max(110, Math.min(410, pos.y));
        }

        function update(deltaTime) {
            // Move player towards target
            const dx = targetPos.x - player.x;
            const dy = targetPos.y - player.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            if (dist > 5) {
                const speed = 5 * (deltaTime / 16.67);
                player.x += (dx / dist) * speed;
                player.y += (dy / dist) * speed;
            }

            // Check coin collision
            for (let i = coins.length - 1; i >= 0; i--) {
                const coin = coins[i];
                const cdx = coin.x - player.x;
                const cdy = coin.y - player.y;
                const cdist = Math.sqrt(cdx * cdx + cdy * cdy);

                if (cdist < 35) {
                    // Collect coin
                    stage.removeChild(coin);
                    coins.splice(i, 1);
                    score += 10;
                    scoreText.text = `ü™ô Score: ${score}`;

                    // Spawn new coin
                    spawnCoin();
                }
            }

            // Animate coins (bob up and down)
            coins.forEach((coin, i) => {
                coin.y += Math.sin(Date.now() / 200 + i) * 0.3;
            });
        }

        function endGame() {
            gameOver = true;

            // Show game over message
            const rating = score >= 200 ? 'üèÜ Amazing!' :
                          score >= 100 ? '‚≠ê Great!' :
                          score >= 50 ? 'üëç Good!' : 'üí™ Keep trying!';

            messageText.text = `Game Over!\n${rating}`;
            messageText.visible = true;

            // Show play again button
            window.playAgainBtn.getContainer().visible = true;
        }

        function resetGame() {
            // Reset state
            gameOver = false;
            score = 0;
            timeLeft = 30;

            // Reset UI
            scoreText.text = 'ü™ô Score: 0';
            timerText.text = `‚è± ${timeLeft}s`;
            timerText.style.fill = 0x5DADE2;
            messageText.visible = false;
            window.playAgainBtn.getContainer().visible = false;

            // Reset player
            player.x = 250;
            player.y = 260;
            targetPos = { x: player.x, y: player.y };

            // Remove old coins and spawn new ones
            coins.forEach(coin => stage.removeChild(coin));
            coins = [];
            for (let i = 0; i < 5; i++) {
                spawnCoin();
            }
        }

        init().catch(console.error);
    </script>
</body>
</html>
